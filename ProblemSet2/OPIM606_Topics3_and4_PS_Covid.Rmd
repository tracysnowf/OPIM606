---
title: "Topics 3 and 4 problem set"
output: html_document
author: Insert Your Name Here
---

## Preparation

```{r setup, include=TRUE, message = FALSE, warning = FALSE}
# Load packages used in this session of R
library(tidyverse)
library(knitr)
library(readxl) # Package to read Excel data

# As needed, set path to folder where data is located.
opts_knit$set(root.dir = "C:/Users/Xue Feng/Desktop/OPIM601-BA/ProblemSet2")
```


#### 1) Load the data from OxCGRT_latest.csv

Oxford provides data on covid deaths/cases and policy variables by day by state. For more background, see this [data archive](https://www.bsg.ox.ac.uk/research/research-projects/coronavirus-government-response-tracker#data) or this [story](https://www.nytimes.com/interactive/2020/11/18/us/covid-state-restrictions.html) that uses the data.


Load this data, limit it to U.S. states and the following variables: RegionName, RegionCode, Date, GovernmentResponseIndex, ConfirmedCases and ConfirmedDeaths.  In addition, add a variable to this data frame using (this variable will help us when merging below).
```{r eval = FALSE}
  mutate("stAbbrev" = str_replace_all(string = RegionCode, pattern = "US_", replacement = "" ))
# OR: mutate("stAbbrev" = gsub("US_", "", RegionCode))
```

Show the first three variables of the first three lines of this data frame.
```{r tidy = FALSE}

```

#### 2)  Create a data frame limited by date and summarised by state

This data frame will include state abbreviation, average state policy ("GovernmentResponseIndex") total deaths by state and total cases by state in a given time period.

For now use StartDate = 20201101 and EndDate = 20201115. Of course you can change to other time periods later (although be sure to assess whether there is missing data for recent dates).

Display the top 3 states.

```{r tidy = FALSE}


```

#### 3)  Merge the data frame to state level data

Merge the above data frame of deaths/cases by period to a state level data set with demographic and political data (the "data" sheet in "USstates.xlsx"). Create variables for deaths and cases per 10,000 people and population density.

Show the first three variables of the first three lines of this data frame.

```{r tidy = FALSE}



```


#### 4) Plot deaths per 10,000 people against density.

Add labels and an OLS fitted line.

We did not cover these in class, but see if you can make the **geom_smooth** and **geom_text** commands work.

Remove an outlier if you think that is necessary.

Use code from lecture or explore other ways to make the figure look better.

```{r tidy = FALSE}


```


#### 5) Plot cases per 10,000 people against density with a color indicating political party of governor. 

Include state labels, but not OLS line.

Remove an outlier if you think that is helpful.

```{r tidy = FALSE}


```


#### 6) Show positive cases as a function of policy, colored by party of governor.

```{r tidy = FALSE}

```



#### BONUS) Do your own analysis!

For example, change the dates and see what happens to the plots.

For example, merge data on hospitalizations from the Covid Tracking Project and do similar analysis as what we have done above.
